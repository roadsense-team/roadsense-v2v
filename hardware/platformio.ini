; PlatformIO Project Configuration File
; RoadSense V2V Enhanced System
; Firmware for ESP32 with MPU9250 (9-axis IMU) + GPS + ML inference
;
; Platform: ESP32 DevKit
; Framework: Arduino
; Sensors: MPU9250 (IMU), NEO-6M (GPS)
; Communication: ESP-NOW mesh networking
; ML: TensorFlow Lite Micro

[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

; Serial monitor settings
monitor_speed = 115200
monitor_filters = colorize, time
; Note: monitor_flags is deprecated, using monitor_filters instead

; Build settings
build_flags =
	-DCORE_DEBUG_LEVEL=5
	-DNUM_VEHICLES=3

; Source filter
build_src_filter =
	+<*>
	+<**/*.cpp>

; Library dependencies
lib_deps =
	; 6-axis IMU (MPU6500: accel + gyro, NO magnetometer)
	; ⚠️ HARDWARE: Received MPU6500 instead of expected MPU9250
	; Using MPU9250_WE library (Wolfgang Ewald) - vendored to lib/
	; - MPU6500_WE base class supports WHO_AM_I = 0x70 (our hardware)
	; - Library includes both MPU6500_WE and MPU9250_WE classes
	; - We use MPU6500_WE directly (no patching needed!)
	; NOTE: Library vendored to lib/MPU9250_WE (not from lib_deps)
	; wollewald/MPU9250_WE@^1.2.0  ← DISABLED (using vendored copy)

	; GPS parsing
	mikalhart/TinyGPSPlus@^1.0.3

	; JSON serialization (for debugging, optional)
	bblanchon/ArduinoJson@^6.21.0

	; SD card data logging (SdFat v2 - high performance)
	greiman/SdFat@^2.3.1

	; TensorFlow Lite Micro for ML inference
	; Note: Will be added when ML integration begins (Phase 4)
	; tensorflow/tflite-micro@^2.15.0

; Upload settings (customize per vehicle)
; Uncomment and modify for your setup:
; upload_port = COM3        ; Windows
; upload_port = /dev/ttyUSB0  ; Linux
; upload_speed = 921600

; Test Configuration
test_framework = unity
test_build_src = yes
test_ignore =
  test_integration/*  ; Skip slow integration tests by default

[env:esp32dev_integration]
extends = env:esp32dev
test_ignore =  ; Run ALL tests including integration

; ==============================================================================
; RTT (Round-Trip Time) Measurement Firmware
; For ESP-NOW characterization tests
; ==============================================================================

[env:rtt_sender]
extends = env:esp32dev
build_src_filter =
	-<*>
	+<../test/espnow_rtt/sender_main.cpp>
	+<sensors/imu/MPU6500Driver.cpp>
	+<sensors/mag/QMC5883LDriver.cpp>
	+<utils/Logger.cpp>
build_flags =
	${env:esp32dev.build_flags}
	-DRTT_SENDER
	-I test/espnow_rtt
lib_deps =
	${env:esp32dev.lib_deps}

[env:rtt_reflector]
extends = env:esp32dev
build_src_filter =
	-<*>
	+<../test/espnow_rtt/reflector_main.cpp>
	+<utils/Logger.cpp>
build_flags =
	${env:esp32dev.build_flags}
	-DRTT_REFLECTOR
	-I test/espnow_rtt
lib_deps =
	${env:esp32dev.lib_deps}
